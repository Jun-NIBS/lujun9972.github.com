<!DOCTYPE html>
<html lang="en">
<head>
  <title>meminfo文件详解 - 暗无天日</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="linux和它的小伙伴" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #ds-thread #ds-reset .ds-comment-body p a {color: #ff0;}
   #ds-thread #ds-reset .ds-comment-body p a:hover {color: #0ff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" href="https://lujun9972.github.io/media/css/main.css" type="text/css"/>
  <link rel="stylesheet" href="https://lujun9972.github.io/media/css/comment.css" type="text/css"/>
</head>

  <body><div class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="https://lujun9972.github.io/">暗无天日</a> <span class="subtitle">=============&gt;随便,谢谢</span></h1>
        <ul>
          <li><a href="https://lujun9972.github.io/years/">Years</a></li>
          <li><a href="https://lujun9972.github.io/authors/">Authors</a></li>
          <li><a href="https://lujun9972.github.io/tags/">Tags</a></li>
          <li><a href="https://lujun9972.github.io/about/">About</a></li>
          <li><a href="https://github.com/lujun9972/lujun9972.github.com">Github</a></li>
          <li><a href="https://lujun9972.github.io/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="lujun9972.github.io">
        </form>
      </header>
    </div>

<div>
<div class="post">
<h1 class="title">meminfo文件详解</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc478074">MemTotal</a></li>
<li><a href="#orga9b5285">MemFree</a></li>
<li><a href="#org7e7ebe1">MemAvailable</a></li>
<li><a href="#org0f29022">Buffers / Cached</a></li>
<li><a href="#org97d1263">SwapCached</a></li>
<li><a href="#org9d00cc3">Active</a></li>
<li><a href="#orge3b9b93">Inactive</a></li>
<li><a href="#org25b7ad9">Active(anon) / Inactive(anon) / Active(file) / Inactive(file)</a></li>
<li><a href="#orgd697955">Unevictable</a></li>
<li><a href="#org0853971">Mlocked</a></li>
<li><a href="#orgd3d9cf0">SwapTotal</a></li>
<li><a href="#org977fdef">SwapFree</a></li>
<li><a href="#orgbf389b2">Dirty</a></li>
<li><a href="#orgc7a9db3">Writeback</a></li>
<li><a href="#org1c4fa0a">AnonPages</a></li>
<li><a href="#orgf36f8aa">Mapped</a></li>
<li><a href="#org8900263">Shmem</a></li>
<li><a href="#org415bcec">Slab</a></li>
<li><a href="#orgb8811a8">SReclaimable</a></li>
<li><a href="#orge8f567e">SUnreclaim</a></li>
<li><a href="#orgb5b9c06">KernelStack</a></li>
<li><a href="#org0167895">PageTables</a></li>
<li><a href="#orged3b954">NFS_Unstable</a></li>
<li><a href="#org36a4e2f">Bounce</a></li>
<li><a href="#orgd6c10c4">WritebackTmp</a></li>
<li><a href="#org8f35509">CommitLimit</a></li>
<li><a href="#org20ef4de">Committed_AS</a></li>
<li><a href="#org84853e1">VmallocTotal</a></li>
<li><a href="#org07fd411">VmallocUsed</a></li>
<li><a href="#org191e47d">VmallocChunk</a></li>
<li><a href="#orgac5af7e">HardwareCorrupted</a></li>
<li><a href="#orgc05c832">AnonHugePages</a></li>
<li><a href="#org300a29b">ShmemHugePages</a></li>
<li><a href="#org3cb95d5">ShmemPmdMapped</a></li>
<li><a href="#org42e9017">HugePages_Total</a></li>
<li><a href="#orgb169179">HugePages_Free</a></li>
<li><a href="#org4032a5a">HugePages_Rsvd</a></li>
<li><a href="#org9b5658f">HugePages_Surp</a></li>
<li><a href="#org8ee6889">Hugepagesize</a></li>
<li><a href="#orga3bd761">DirectMap4k</a></li>
<li><a href="#orgced9676">DirectMap2M</a></li>
</ul>
</div>
</div>
<p>
我们可以从 <code>/proc/meminfo</code> 中查看内核使用内存情况的各种信息。
</p>

<p>
一个 <code>/proc/meminfo</code> 的内容看起来是这样的：
</p>
<div class="org-src-container">
<pre class="src src-shell">cat /proc/meminfo |nl
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org"> 1  MemTotal:        3814108 kB
 2  MemFree:          111908 kB
 3  MemAvailable:     394844 kB
 4  Buffers:           22976 kB
 5  Cached:           291436 kB
 6  SwapCached:        15480 kB
 7  Active:          1634948 kB
 8  Inactive:         784896 kB
 9  Active(anon):    1487400 kB
10  Inactive(anon):   474008 kB
11  Active(file):     147548 kB
12  Inactive(file):   310888 kB
13  Unevictable:           0 kB
14  Mlocked:               0 kB
15  SwapTotal:       8388604 kB
16  SwapFree:        8238844 kB
17  Dirty:             22280 kB
18  Writeback:             0 kB
19  AnonPages:       2103892 kB
20  Mapped:          1262612 kB
21  Shmem:             81684 kB
22  Slab:              99048 kB
23  SReclaimable:      53432 kB
24  SUnreclaim:        45616 kB
25  KernelStack:        8352 kB
26  PageTables:        24152 kB
27  NFS_Unstable:          0 kB
28  Bounce:                0 kB
29  WritebackTmp:          0 kB
30  CommitLimit:    10295656 kB
31  Committed_AS:    6235812 kB
32  VmallocTotal:   34359738367 kB
33  VmallocUsed:           0 kB
34  VmallocChunk:          0 kB
35  HardwareCorrupted:     0 kB
36  AnonHugePages:         0 kB
37  ShmemHugePages:        0 kB
38  ShmemPmdMapped:        0 kB
39  HugePages_Total:       0
40  HugePages_Free:        0
41  HugePages_Rsvd:        0
42  HugePages_Surp:        0
43  Hugepagesize:       2048 kB
44  DirectMap4k:      106112 kB
45  DirectMap2M:     3858432 kB
</pre>
</div>

<p>
可以看出，这里的内核信息特别多，有些含义很难理解。
</p>

<p>
下面就来尝试解释一下这些行的意义：
</p>

<div id="outline-container-orgc478074" class="outline-2">
<h2 id="orgc478074">MemTotal</h2>
<div class="outline-text-2" id="text-orgc478074">
<p>
总共安装的物理内存容量
</p>
</div>
</div>
<div id="outline-container-orga9b5285" class="outline-2">
<h2 id="orga9b5285">MemFree</h2>
<div class="outline-text-2" id="text-orga9b5285">
<p>
当前空闲的内存量
</p>
</div>
</div>
<div id="outline-container-org7e7ebe1" class="outline-2">
<h2 id="org7e7ebe1">MemAvailable</h2>
</div>
<div id="outline-container-org0f29022" class="outline-2">
<h2 id="org0f29022">Buffers / Cached</h2>
<div class="outline-text-2" id="text-org0f29022">
<p>
buffers + cached的值就是可以使用的磁盘告诉缓存的大小。
</p>

<p>
buffers + cached = Active(file) + Inactive(file) + Shmem
</p>
</div>
</div>

<div id="outline-container-org97d1263" class="outline-2">
<h2 id="org97d1263">SwapCached</h2>
<div class="outline-text-2" id="text-org97d1263">
<p>
记录在交换缓存上的内容容量。
</p>

<p>
所谓交换缓存是指，在换入某个内存页之后，物理磁盘上的交换空间依然保留同样的数据，这样的内存页会记录在"交换缓存"的列表上。
这样的好处在于，当需要再次换出记录在交换缓存中的的内存页时，可以直接使用交换分区中保存的内容，而无需将内存再次写入交换空间。
</p>

<p>
当该交换空间上的其他数据被换出，或是换入内存中的数据被改写，则交换缓存上的记录会被清空。
</p>
</div>
</div>
<div id="outline-container-org9d00cc3" class="outline-2">
<h2 id="org9d00cc3">Active</h2>
<div class="outline-text-2" id="text-org9d00cc3">
<p>
等于Active(anon) + Active(file)的和
</p>
</div>
</div>
<div id="outline-container-orge3b9b93" class="outline-2">
<h2 id="orge3b9b93">Inactive</h2>
<div class="outline-text-2" id="text-orge3b9b93">
<p>
等于Inactive(anon) + Inactive(file)的和
</p>
</div>
</div>
<div id="outline-container-org25b7ad9" class="outline-2">
<h2 id="org25b7ad9">Active(anon) / Inactive(anon) / Active(file) / Inactive(file)</h2>
<div class="outline-text-2" id="text-org25b7ad9">
<p>
括号中为anon的内存为匿名内存，括号中为file的内存为file-backed内存，这两个内存的区别在于，物理内存的内容是否与物理磁盘上的文件相关联。
</p>

<p>
其中，匿名内存就是进程中堆上分配的内存，是用malloc分配的内存。
</p>

<p>
而file-backed内存为磁盘高速缓存的内存空间和“文件映射(将物理磁盘上的文件内容与用户进程的逻辑地址直接关联)”的内存空间，其中的内容与物理磁盘上的文件相对应。
</p>

<p>
而Active和Inactive的区别在于内存空间中是否包含最近被使用过的数据。当物理内存不足，不得不释放正在使用的内存空间时，会优先释放Inactive的内存空间。
</p>

<p>
Linux内核中使用4类LRU表来分别记录对应的这4类内存页,内存页一般以4K为一页。
</p>
</div>
</div>
<div id="outline-container-orgd697955" class="outline-2">
<h2 id="orgd697955">Unevictable</h2>
<div class="outline-text-2" id="text-orgd697955">
<p>
有些内存页是不能被释放的，这些内存页不能放在LRU表中，而是记录到Unevictable标中
</p>
</div>
</div>
<div id="outline-container-org0853971" class="outline-2">
<h2 id="org0853971">Mlocked</h2>
</div>

<div id="outline-container-orgd3d9cf0" class="outline-2">
<h2 id="orgd3d9cf0">SwapTotal</h2>
<div class="outline-text-2" id="text-orgd3d9cf0">
<p>
交换空间的总大小
</p>
</div>
</div>
<div id="outline-container-org977fdef" class="outline-2">
<h2 id="org977fdef">SwapFree</h2>
<div class="outline-text-2" id="text-org977fdef">
<p>
交换空间的剩余容量
</p>
</div>
</div>
<div id="outline-container-orgbf389b2" class="outline-2">
<h2 id="orgbf389b2">Dirty</h2>
<div class="outline-text-2" id="text-orgbf389b2">
<p>
脏数据，在磁盘缓冲区中尚未写入物理磁盘的内存大小
</p>
</div>
</div>
<div id="outline-container-orgc7a9db3" class="outline-2">
<h2 id="orgc7a9db3">Writeback</h2>
</div>
<div id="outline-container-org1c4fa0a" class="outline-2">
<h2 id="org1c4fa0a">AnonPages</h2>
<div class="outline-text-2" id="text-org1c4fa0a">
<p>
Linux内核中存在一个rmap(reverse mapping)机制，负责管理匿名内存中每一个物理内存页映射到哪个进程的哪个逻辑地址这样的信息。
这个rmap中记录的内存页总和就是AnonPages的值。
</p>
</div>
</div>

<div id="outline-container-orgf36f8aa" class="outline-2">
<h2 id="orgf36f8aa">Mapped</h2>
</div>
<div id="outline-container-org8900263" class="outline-2">
<h2 id="org8900263">Shmem</h2>
<div class="outline-text-2" id="text-org8900263">
<p>
tmpfs所使用的内存.
</p>

<p>
tmpfs即利用物理内存来提供RAM磁盘的功能。在tmpfs上保存文件时，文件系统会暂时将它们保存到磁盘高速缓存上，因此它是属于磁盘高速缓存对应的"buffers+cached"一类。
但是由于磁盘上并没有与之对应的内容，因此它并记录在File-backed内存对应的LRU列表上，而是记录在匿名内存的LRU表上。
这就是 <code>buffers + cached = Active(file) + Inactive(file) + Shmem</code> 公式的由来
</p>
</div>
</div>


<div id="outline-container-org415bcec" class="outline-2">
<h2 id="org415bcec">Slab</h2>
<div class="outline-text-2" id="text-org415bcec">
<p>
由"Slab分配器"分配的总量。Slab分配器针对一些经常分配并释放的对象(如进程描述符)统计各种数据类型的汇总信息，然后为每种数据类型创建多个由多个内存页组成的Slab(这些Slab组成一个Slab列表)。
再在Slab内部划分成一个个相应数据类型的对象。
</p>

<p>
当内核要使用某种类型的数据结构时，就从对应的slab列表中分配一个对象出去，而当要释放时，将其重新保存在Slab列表中，从而避免内存碎片。
</p>

<p>
当可供使用的对象不足时，会使用空闲的内存页来创建并添加新的Slab到对应对象的Slab列表中。
相反，若Slab中所有对象都被内核回收，即所有对象都未使用时，根据需要也可以回收Slab，释放成空闲内存。
</p>

<p>
从 <code>/proc/slabinfo</code> 中我们可以查看每个Slab的信息：
</p>

<div class="org-src-container">
<pre class="src src-shell">sudo cat /proc/slabinfo |head
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">slabinfo - version: 2.1
<span style="color: #2aa1ae; background-color: #292e34;"># name            &lt;active_objs&gt; &lt;num_objs&gt; &lt;objsize&gt; &lt;objperslab&gt; &lt;pagesperslab&gt; : tunables &lt;limit&gt; &lt;batchcount&gt; &lt;sharedfactor&gt; : slabdata &lt;active_slabs&gt; &lt;num_slabs&gt; &lt;sharedavail&gt;</span>
nf_conntrack          27     72    320   12    1 : tunables    0    0    0 : slabdata      6      6      0
ovl_inode             46     46    688   23    4 : tunables    0    0    0 : slabdata      2      2      0
fuse_request          40     40    400   20    2 : tunables    0    0    0 : slabdata      2      2      0
fuse_inode            19     19    832   19    4 : tunables    0    0    0 : slabdata      1      1      0
xfs_dqtrx              0      0    528   15    2 : tunables    0    0    0 : slabdata      0      0      0
xfs_rui_item           0      0    672   12    2 : tunables    0    0    0 : slabdata      0      0      0
xfs_rud_item           0      0    152   26    1 : tunables    0    0    0 : slabdata      0      0      0
xfs_ili             4486   4488    168   24    1 : tunables    0    0    0 : slabdata    187    187      0
</pre>
</div>

<p>
其中：
</p>

<dl class="org-dl">
<dt>name</dt><dd>对象名称</dd>
<dt>active_objs</dt><dd>处于活跃状态的对象个数</dd>
<dt>num_objs</dt><dd>slab列表中的总对象数量</dd>
<dt>objperslab</dt><dd>一个slab中包含的对象个数</dd>
<dt>pageperslab</dt><dd>每个slab占用的内存页数</dd>
<dt>num_slabs</dt><dd>slab列表中slab的个数</dd>
<dt>active_slabs</dt><dd>处于活跃状态的slab个数</dd>
</dl>
</div>
</div>

<div id="outline-container-orgb8811a8" class="outline-2">
<h2 id="orgb8811a8">SReclaimable</h2>
<div class="outline-text-2" id="text-orgb8811a8">
<p>
不存在活跃对象，可以回收的Slab容量
</p>
</div>
</div>
<div id="outline-container-orge8f567e" class="outline-2">
<h2 id="orge8f567e">SUnreclaim</h2>
<div class="outline-text-2" id="text-orge8f567e">
<p>
对象处于活跃状态，不能被回收的Slab容量
</p>
</div>
</div>
<div id="outline-container-orgb5b9c06" class="outline-2">
<h2 id="orgb5b9c06">KernelStack</h2>
<div class="outline-text-2" id="text-orgb5b9c06">
<p>
KernelStack是内核代码使用的堆栈区域。
</p>

<p>
由于Linux内核中用户进程在运行过程中需要不断切换，因此内核需要为每个用户进程都设置各自的堆栈区域。
因此，每启动一个新进程，KernelStack的值都会增加。
</p>
</div>
</div>
<div id="outline-container-org0167895" class="outline-2">
<h2 id="org0167895">PageTables</h2>
<div class="outline-text-2" id="text-org0167895">
<p>
PageTables就是页表，用于存储各个用户进程的逻辑地址和物理地址的变换关系，它本身也是一个内存区域。
</p>
</div>
</div>
<div id="outline-container-orged3b954" class="outline-2">
<h2 id="orged3b954">NFS_Unstable</h2>
</div>
<div id="outline-container-org36a4e2f" class="outline-2">
<h2 id="org36a4e2f">Bounce</h2>
</div>
<div id="outline-container-orgd6c10c4" class="outline-2">
<h2 id="orgd6c10c4">WritebackTmp</h2>
</div>
<div id="outline-container-org8f35509" class="outline-2">
<h2 id="org8f35509">CommitLimit</h2>
</div>
<div id="outline-container-org20ef4de" class="outline-2">
<h2 id="org20ef4de">Committed_AS</h2>
</div>
<div id="outline-container-org84853e1" class="outline-2">
<h2 id="org84853e1">VmallocTotal</h2>
<div class="outline-text-2" id="text-org84853e1">
<p>
Linux使用内存时，除了使用Slab中配置的对象外，还能直接将空闲内存页映射到逻辑地址上。
</p>

<p>
这个容量指的是，理论上内核内部可以用来映射的逻辑地址的范围。这个值非常大，但并非实际使用的物理内存
</p>
</div>
</div>
<div id="outline-container-org07fd411" class="outline-2">
<h2 id="org07fd411">VmallocUsed</h2>
<div class="outline-text-2" id="text-org07fd411">
<p>
实际上，Linux将空闲内存页映射到逻辑地址上的容量。
</p>

<p>
值得说明的是，这个容量除了物理内存上所作的映射外，也包括诸如视频卡这样的外部设备内存所作的映射，这类映射叫做"ioremap"
</p>

<p>
我们可以通过 <code>/proc/vmallocainfo</code> 查看VmallocUsed中包含内存区域的详情
</p>
<div class="org-src-container">
<pre class="src src-shell">cat /proc/vmallocinfo |head
</pre>
</div>

<p>
其中
</p>

<ul class="org-ul">
<li>第一列为逻辑地址的范围</li>
<li>第二列为容量，以字节为单位</li>
<li>最后一列若为ioremap，说明该映射为ioremap</li>
</ul>

<p>
所以要计算除ioremap外物理内存的映射量，可以这么计算
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo cat /proc/vmallocinfo |grep -v <span style="color: #2d9574;">"ioremap"</span> |awk <span style="color: #2d9574;">'{total=total+$2};END{print total}'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">107110400
</pre>
</div>
</div>
</div>

<div id="outline-container-org191e47d" class="outline-2">
<h2 id="org191e47d">VmallocChunk</h2>
</div>
<div id="outline-container-orgac5af7e" class="outline-2">
<h2 id="orgac5af7e">HardwareCorrupted</h2>
</div>
<div id="outline-container-orgc05c832" class="outline-2">
<h2 id="orgc05c832">AnonHugePages</h2>
</div>
<div id="outline-container-org300a29b" class="outline-2">
<h2 id="org300a29b">ShmemHugePages</h2>
</div>
<div id="outline-container-org3cb95d5" class="outline-2">
<h2 id="org3cb95d5">ShmemPmdMapped</h2>
</div>
<div id="outline-container-org42e9017" class="outline-2">
<h2 id="org42e9017">HugePages_Total</h2>
</div>
<div id="outline-container-orgb169179" class="outline-2">
<h2 id="orgb169179">HugePages_Free</h2>
</div>
<div id="outline-container-org4032a5a" class="outline-2">
<h2 id="org4032a5a">HugePages_Rsvd</h2>
</div>
<div id="outline-container-org9b5658f" class="outline-2">
<h2 id="org9b5658f">HugePages_Surp</h2>
</div>
<div id="outline-container-org8ee6889" class="outline-2">
<h2 id="org8ee6889">Hugepagesize</h2>
</div>
<div id="outline-container-orga3bd761" class="outline-2">
<h2 id="orga3bd761">DirectMap4k</h2>
</div>
<div id="outline-container-orgced9676" class="outline-2">
<h2 id="orgced9676">DirectMap2M</h2>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2018-04-17</span>
            <span title="last modification date" class="post-info">2018-04-18</span>
            <span title="tags" class="post-info">:<a href="https://lujun9972.github.io/tags/linux和它的小伙伴">linux和它的小伙伴</a>:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; T520">lujun9972</a></span>
        </div>
    <script src="https://lujun9972.github.io/media/js/jquery-2.1.3.min.js"></script>
        <section>
            <h1>Comments</h1>
            <div id="comment-wrap">
                    <a class="disqus_label">使用 Disqus 评论</a>
    </ul>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
         //var disqus_developer = 1;
         var preempt_signal=false;
         var disqus_identifier = "/blog/2018/04/17/meminfo文件详解/";
         var disqus_url = "https://lujun9972.github.io/blog/2018/04/17/meminfo文件详解/";
         var disqus_shortname = 'lujun9972';
         /* * * DON'T EDIT BELOW THIS LINE * * */
         (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
             $('#disqus_thread').css('display','none');
         })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    <script>
     /* comments */
     var ego_disqus_thread=$('#disqus_thread');
     var ego_ds_label=$('.ds-thread');
     $('.disqus_label').click(function(){
         ego_disqus_thread.show();
         ego_ds_label.hide();
     });
     $('.ds-label').click(function(){
         ego_disqus_thread.hide();
         ego_ds_label.show();
     });
    </script>
        </section>
    <script src="https://lujun9972.github.io/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T520">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div></body>
</html>
