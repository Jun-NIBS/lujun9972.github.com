#+TITLE: 使用bash随机更换壁纸
#+AUTHOR: lujun9972
#+TAGS: linux和它的小伙伴
#+DATE: [2018-04-24 二 10:49]
#+LANGUAGE:  zh-CN
#+OPTIONS:  H:6 num:nil toc:t \n:nil ::t |:t ^:nil -:nil f:t *:t <:nil

本文要做的事情是写一个脚本，用来随机地从 =reddit= 的 =wallpapers= 中挑选一张壁纸应用到卓面上。

* 所需工具
+ wget :: 下载URL和壁纸图片
+ grep :: 从URL中抽取指向壁纸的URL
+ feh :: 设置壁纸到桌面上
+ shuf :: 产生随机效果

* 壁纸的来源
为了简便处理，我们只从 https://www.reddit.com/r/wallpapers/ 的第一页中随机选取壁纸。

* 实现步骤

用浏览器打开 https://www.reddit.com/r/wallpapers/ 你就会发现它列出了最新产生的25个帖子。

[[file:./images/screenshot-47.png]]

点开帖子就会显示出具体的壁纸内容来
[[file:./images/screenshot-48.png]]

所以我们要做的其实就是下面几步：
1. 从 https://www.reddit.com/r/wallpapers/ 中抽取出帖子的链接
2. 随机选择一个帖子链接
3. 找出帖子链接中图片的URL
4. 下载并设置壁纸

** 从 https://www.reddit.com/r/wallpapers/ 中抽取出帖子的链接
首先让我们用 =wget= 下载 https://www.reddit.com/r/wallpapers/ 页面来分析一下该如何抽取出帖子的链接呢。

#+BEGIN_SRC shell
  wget  https://www.reddit.com/r/wallpapers -O -
#+END_SRC

这条命令会下载 https://www.reddit.com/r/wallpapers/ 页面然后将内容显示在标准输出中。

由于内容太多，这里就不列出具体的内容了。我们先把网页中所有的链接过滤出来看看都有哪些内容.
#+BEGIN_SRC shell :results org
  wget  https://www.reddit.com/r/wallpapers -O - |grep -o -E 'href="([^"#]+)"'
#+END_SRC

#+RESULTS:
#+BEGIN_SRC org
href="/static/opensearch.xml"
href="https://www.reddit.com/r/wallpapers/"
href="//out.reddit.com"
href="//out.reddit.com"
href="//www.redditstatic.com/desktop2x/img/favicon/apple-icon-57x57.png"
href="//www.redditstatic.com/desktop2x/img/favicon/apple-icon-60x60.png"
href="//www.redditstatic.com/desktop2x/img/favicon/apple-icon-72x72.png"
href="//www.redditstatic.com/desktop2x/img/favicon/apple-icon-76x76.png"
href="//www.redditstatic.com/desktop2x/img/favicon/apple-icon-114x114.png"
href="//www.redditstatic.com/desktop2x/img/favicon/apple-icon-120x120.png"
href="//www.redditstatic.com/desktop2x/img/favicon/apple-icon-144x144.png"
href="//www.redditstatic.com/desktop2x/img/favicon/apple-icon-152x152.png"
href="//www.redditstatic.com/desktop2x/img/favicon/apple-icon-180x180.png"
href="//www.redditstatic.com/desktop2x/img/favicon/android-icon-192x192.png"
href="//www.redditstatic.com/desktop2x/img/favicon/favicon-32x32.png"
href="//www.redditstatic.com/desktop2x/img/favicon/favicon-96x96.png"
href="//www.redditstatic.com/desktop2x/img/favicon/favicon-16x16.png"
href="//www.redditstatic.com/desktop2x/img/favicon/manifest.json"
href="https://www.reddit.com/r/wallpapers/.rss"
href="//www.redditstatic.com/reddit.GgV4jPzvTdI.css"
href="//www.redditstatic.com/expando.gMzRK16vwrQ.css"
href="//www.redditstatic.com/crosspost-preview.De3P20Yb4PY.css"
href="//www.redditstatic.com/author-tooltip.uiV1oYrKgxk.css"
href="//www.redditstatic.com/listing-comments.AZZO7Kj_O88.css"
href="//www.redditstatic.com/popup-notification.6-JvPBpHWMo.css"
href="//www.redditstatic.com/desktoponboarding.pXPmBeaw4d0.css"
href="//www.redditstatic.com/videoplayer.YbUSlMWPXyg.css"
href="//www.redditstatic.com/videoplayercontrols.a_TwaTy76-k.css"
href="https://b.thumbs.redditmedia.com/K3WEm4fCo57Q7ynZmVRC2r836fKL29jS8dy6JHzZRHo.css"
href="javascript: void 0;"
href="."
href="javascript: void 0;"
href="."
href="/password"
href="https://www.reddit.com/help/useragreement/"
href="https://www.reddit.com/help/privacypolicy/"
href="https://www.reddit.com/help/contentpolicy/"
href="."
href="."
href="javascript: void 0;"
href="https://www.reddit.com/subreddits/"
href="https://www.reddit.com/r/popular/"
href="https://www.reddit.com/r/all/"
href="https://www.reddit.com/r/random/"
href="https://www.reddit.com/users/"
href="https://www.reddit.com/r/AskReddit/"
href="https://www.reddit.com/r/worldnews/"
href="https://www.reddit.com/r/videos/"
href="https://www.reddit.com/r/funny/"
href="https://www.reddit.com/r/todayilearned/"
href="https://www.reddit.com/r/pics/"
href="https://www.reddit.com/r/gaming/"
href="https://www.reddit.com/r/movies/"
href="https://www.reddit.com/r/news/"
href="https://www.reddit.com/r/gifs/"
href="https://www.reddit.com/r/mildlyinteresting/"
href="https://www.reddit.com/r/aww/"
href="https://www.reddit.com/r/Showerthoughts/"
href="https://www.reddit.com/r/television/"
href="https://www.reddit.com/r/Jokes/"
href="https://www.reddit.com/r/science/"
href="https://www.reddit.com/r/OldSchoolCool/"
href="https://www.reddit.com/r/sports/"
href="https://www.reddit.com/r/IAmA/"
href="https://www.reddit.com/r/Documentaries/"
href="https://www.reddit.com/r/TwoXChromosomes/"
href="https://www.reddit.com/r/explainlikeimfive/"
href="https://www.reddit.com/r/personalfinance/"
href="https://www.reddit.com/r/books/"
href="https://www.reddit.com/r/tifu/"
href="https://www.reddit.com/r/Futurology/"
href="https://www.reddit.com/r/dataisbeautiful/"
href="https://www.reddit.com/r/WritingPrompts/"
href="https://www.reddit.com/r/nottheonion/"
href="https://www.reddit.com/r/food/"
href="https://www.reddit.com/r/Music/"
href="https://www.reddit.com/r/photoshopbattles/"
href="https://www.reddit.com/r/EarthPorn/"
href="https://www.reddit.com/r/philosophy/"
href="https://www.reddit.com/r/Art/"
href="https://www.reddit.com/r/nosleep/"
href="https://www.reddit.com/r/GetMotivated/"
href="https://www.reddit.com/r/askscience/"
href="https://www.reddit.com/r/LifeProTips/"
href="https://www.reddit.com/r/space/"
href="https://www.reddit.com/r/UpliftingNews/"
href="https://www.reddit.com/r/DIY/"
href="https://www.reddit.com/r/history/"
href="https://www.reddit.com/r/gadgets/"
href="https://www.reddit.com/r/creepy/"
href="https://www.reddit.com/r/listentothis/"
href="https://www.reddit.com/r/blog/"
href="https://www.reddit.com/r/announcements/"
href="https://www.reddit.com/r/InternetIsBeautiful/"
href="https://www.reddit.com/subreddits/"
href="https://www.reddit.com/"
href="https://www.reddit.com/r/wallpapers/"
href="https://www.reddit.com/r/wallpapers/"
href="https://www.reddit.com/r/wallpapers/new/"
href="https://www.reddit.com/r/wallpapers/rising/"
href="https://www.reddit.com/r/wallpapers/controversial/"
href="https://www.reddit.com/r/wallpapers/top/"
href="https://www.reddit.com/r/wallpapers/gilded/"
href="https://www.reddit.com/r/wallpapers/wiki/"
href="https://www.reddit.com/login"
href="https://www.reddit.com/login"
href="javascript:void(0)"
href="https://www.reddit.com/wiki/search"
href="https://www.reddit.com/wiki/search"
href="/password"
href="https://www.reddit.com/r/wallpapers/submit"
href="https://www.reddit.com/r/wallpapers/submit?selftext=true"
href="https://www.reddit.com/r/wallpapers/"
href="/r/NSFW_Wallpapers/"
href="/r/gmbwallpapers"
href="/r/Offensive_Wallpapers"
href="http://www.reddit.com/r/wallpapers/wiki/rules"
href="https://www.reddit.com/r/wallpapers/wiki/guidelines"
href="/r/wallpaperrequests"
href="/r/PhotoshopRequest"
href="http://jvl.bz/?ab5fd"
href="http://reddpics.com/r/wallpapers/"
href="http://www.panoptikos.com/r/wallpapers"
href="/u/Ugleh"
href="/r/rwallpaperchanger"
href="/u/mjbauer95"
href="http://redd.it/2y89p8"
href="/r/iWallpaper"
href="/r/VerticalWallpapers"
href="/r/tallwalls"
href="/r/MobileWallpaper"
href="/r/help"
href="/r/wallpaperdump"
href="/r/wallpaperpacks"
href="/r/help2"
href="/r/WQHD_Wallpaper/"
href="/r/WidescreenWallpaper/"
href="/r/triplescreenplus"
href="/r/multiwall"
href="/r/ComicWalls"
href="http://www.reddit.com/r/nocontext_wallpapers"
href="/r/animewallpaper"
href="/r/offensive_wallpapers"
href="/r/slashw/"
href="/r/desktoplego"
href="/r/musicwallpapers"
href="/r/ImaginaryLandscapes+ImaginaryMonsters+ImaginaryCharacters+ImaginaryTechnology"
href="http://www.reddit.com/user/imaginarymod/m/imaginaryexpanded"
href="/r/BackgroundArt"
href="/r/HI_Res/"
href="/r/SpecArt"
href="/r/wallpaper+wallpapers"
href="/r/quotesporn/"
href="/r/unixporn"
href="/r/Livingbackgrounds"
href="/r/desktops"
href="/r/AMOLEDBackgrounds"
href="/r/rainmeter"
href="/r/earthview/"
href="/message/compose?to=%2Fr%2Fwallpapers"
href="https://www.reddit.com/user/thmanwithnoname"
href="https://www.reddit.com/user/nothingsaidalice"
href="https://www.reddit.com/user/hero0fwar"
href="https://www.reddit.com/user/campymountain"
href="https://www.reddit.com/user/pmaxm00"
href="https://www.reddit.com/user/thmodwithnoname"
href="https://www.reddit.com/user/MrAwkwardCrotch"
href="/r/wallpapers/about/moderators"
href="/login"
href="/r/wallpapers/comments/8efq4z/3d_city_glitch_1920x1080/"
href="/r/wallpapers/comments/8efq4z/3d_city_glitch_1920x1080/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/BradFMB"
href="https://www.reddit.com/r/wallpapers/comments/8efq4z/3d_city_glitch_1920x1080/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8e7k5i/ghost_in_the_shell/"
href="/r/wallpapers/comments/8e7k5i/ghost_in_the_shell/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/Aileos"
href="https://www.reddit.com/r/wallpapers/comments/8e7k5i/ghost_in_the_shell/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="https://i.imgur.com/0eSNAHv.jpg"
href="https://i.imgur.com/0eSNAHv.jpg"
href="/domain/i.imgur.com/"
href="https://www.reddit.com/user/KorvisKhan"
href="https://www.reddit.com/r/wallpapers/comments/8ebjj0/credit_to_whoever_took_this_picture_i_forget/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8ebyvm/snowy_hills_3840_2160/"
href="/r/wallpapers/comments/8ebyvm/snowy_hills_3840_2160/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/sequence_string"
href="https://www.reddit.com/r/wallpapers/comments/8ebyvm/snowy_hills_3840_2160/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8eapkd/beautiful_purple_sunset_1920x180/"
href="/r/wallpapers/comments/8eapkd/beautiful_purple_sunset_1920x180/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/pakaau"
href="https://www.reddit.com/r/wallpapers/comments/8eapkd/beautiful_purple_sunset_1920x180/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="https://imgur.com/a/zR2iLXL"
href="https://imgur.com/a/zR2iLXL"
href="/domain/imgur.com/"
href="https://www.reddit.com/user/PiekarnikCiepla"
href="https://www.reddit.com/r/wallpapers/comments/8edl5j/vaporwave_hills_3840x2160/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8ebyo5/another_whale_seen_in_the_sky_2880x1800/"
href="/r/wallpapers/comments/8ebyo5/another_whale_seen_in_the_sky_2880x1800/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/emem01"
href="https://www.reddit.com/r/wallpapers/comments/8ebyo5/another_whale_seen_in_the_sky_2880x1800/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8eaglp/tripy_leaf_wallpaper_edited_from_an_unsplash_image/"
href="/r/wallpapers/comments/8eaglp/tripy_leaf_wallpaper_edited_from_an_unsplash_image/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/xypnox"
href="https://www.reddit.com/r/wallpapers/comments/8eaglp/tripy_leaf_wallpaper_edited_from_an_unsplash_image/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8e2rq7/rush_downtown_thebadbadben_2732x1536/"
href="/r/wallpapers/comments/8e2rq7/rush_downtown_thebadbadben_2732x1536/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/acoolrocket"
href="https://www.reddit.com/r/wallpapers/comments/8e2rq7/rush_downtown_thebadbadben_2732x1536/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8efhr9/all_our_gods_have_abandoned_us_architectsuk/"
href="/r/wallpapers/comments/8efhr9/all_our_gods_have_abandoned_us_architectsuk/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/Wanderingadventurer1"
href="https://www.reddit.com/r/wallpapers/comments/8efhr9/all_our_gods_have_abandoned_us_architectsuk/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8e3qbh/remember_this_always_loved_this_wallpaper_from/"
href="/r/wallpapers/comments/8e3qbh/remember_this_always_loved_this_wallpaper_from/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/nathanhelms"
href="https://www.reddit.com/r/wallpapers/comments/8e3qbh/remember_this_always_loved_this_wallpaper_from/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8e4ni5/long_past_civlization_4000_2349/"
href="/r/wallpapers/comments/8e4ni5/long_past_civlization_4000_2349/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/sequence_string"
href="https://www.reddit.com/r/wallpapers/comments/8e4ni5/long_past_civlization_4000_2349/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8e6281/bus/"
href="/r/wallpapers/comments/8e6281/bus/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/aMAKiNA"
href="https://www.reddit.com/r/wallpapers/comments/8e6281/bus/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8e2c57/fluid_mechanics_beeple_3840x2160/"
href="/r/wallpapers/comments/8e2c57/fluid_mechanics_beeple_3840x2160/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/acoolrocket"
href="https://www.reddit.com/r/wallpapers/comments/8e2c57/fluid_mechanics_beeple_3840x2160/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="https://i.redd.it/g5g7mtzvmht01.jpg"
href="https://i.redd.it/g5g7mtzvmht01.jpg"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/ravigpcr"
href="https://www.reddit.com/r/wallpapers/comments/8e5j95/tulips_at_5_am_1920x1280/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="https://i.imgur.com/e20bxsn.png"
href="https://i.imgur.com/e20bxsn.png"
href="/domain/i.imgur.com/"
href="https://www.reddit.com/user/Cyrado"
href="https://www.reddit.com/r/wallpapers/comments/8e3r13/a_deer_in_the_forest_1920x1080/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8e62jt/froggo/"
href="/r/wallpapers/comments/8e62jt/froggo/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/enthalpychange"
href="https://www.reddit.com/r/wallpapers/comments/8e62jt/froggo/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8e4xv5/abstract_swirls_2560x1600/"
href="/r/wallpapers/comments/8e4xv5/abstract_swirls_2560x1600/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/slippypenguin"
href="https://www.reddit.com/r/wallpapers/comments/8e4xv5/abstract_swirls_2560x1600/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="https://i.imgur.com/tSJKOgO.png"
href="https://i.imgur.com/tSJKOgO.png"
href="/domain/i.imgur.com/"
href="https://www.reddit.com/user/ScrumScrum"
href="https://www.reddit.com/r/wallpapers/comments/8dvuro/samurai_spiral_1536_x_864/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8e1j0g/blossom_wallpaper_shot_by_me/"
href="/r/wallpapers/comments/8e1j0g/blossom_wallpaper_shot_by_me/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/lemonchoosle"
href="https://www.reddit.com/r/wallpapers/comments/8e1j0g/blossom_wallpaper_shot_by_me/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="https://i.imgur.com/u7Wm6aB.jpg"
href="https://i.imgur.com/u7Wm6aB.jpg"
href="/domain/i.imgur.com/"
href="https://www.reddit.com/user/PruneSlicker"
href="https://www.reddit.com/r/wallpapers/comments/8dy02y/lagoon_nebula/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="https://plus.google.com/+AndreZimmermannSolidKakadu/posts/TubV2qkUq3T"
href="https://plus.google.com/+AndreZimmermannSolidKakadu/posts/TubV2qkUq3T"
href="/domain/plus.google.com/"
href="https://www.reddit.com/user/Amit_In"
href="https://www.reddit.com/r/wallpapers/comments/8e4t9z/wallpaper_for_multi_screen_setup/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8do356/living_tree_4000_2400/"
href="/r/wallpapers/comments/8do356/living_tree_4000_2400/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/sequence_string"
href="https://www.reddit.com/r/wallpapers/comments/8do356/living_tree_4000_2400/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="https://i.imgur.com/cRALLF2.jpg"
href="https://i.imgur.com/cRALLF2.jpg"
href="/domain/i.imgur.com/"
href="https://www.reddit.com/user/mandeepkc"
href="https://www.reddit.com/r/wallpapers/comments/8dviei/ruined_canvas/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="/r/wallpapers/comments/8dvzwe/infinity_gauntlet_3840x2160/"
href="/r/wallpapers/comments/8dvzwe/infinity_gauntlet_3840x2160/"
href="/domain/i.redd.it/"
href="https://www.reddit.com/user/fresk0"
href="https://www.reddit.com/r/wallpapers/comments/8dvzwe/infinity_gauntlet_3840x2160/"
href="javascript: void 0;"
href="javascript:void(0)"
href="javascript:void(0)"
href="https://www.reddit.com/r/wallpapers/?count=25&amp;after=t3_8dvzwe"
href="/"
href="https://redditblog.com"
href="https://www.redditinc.com"
href="https://www.redditinc.com/advertising"
href="https://www.redditinc.com/careers"
href="https://www.reddit.com/rules/"
href="https://www.reddithelp.com"
href="https://www.reddit.com/wiki/"
href="https://www.reddit.com/wiki/reddiquette/"
href="https://www.reddit.com/help/healthycommunities/"
href="https://www.reddit.com/contact/"
href="https://itunes.apple.com/us/app/reddit-the-official-app/id1064216828?mt=8"
href="https://play.google.com/store/apps/details?id=com.reddit.frontpage"
href="https://www.reddit.com/buttons/"
href="https://www.reddit.com/gold/about/"
href="http://redditgifts.com"
href="https://www.reddit.com/help/useragreement"
href="https://www.reddit.com/help/privacypolicy"
href="."
href="javascript: void 0;"
href="."
href="/password"
href="https://www.reddit.com/help/useragreement/"
href="https://www.reddit.com/help/privacypolicy/"
href="https://www.reddit.com/help/contentpolicy/"
href="."
href="."
href="javascript: void 0;"
href="https://www.reddit.com/r/i18n/wiki/getting_started"
#+END_SRC

你会发现结果中包含了很多乱七八糟的链接。我们还有必要做进一步的过滤。

通过分析这些帖子的URL，可以看出它们都是以 =https://www.reddit.com/r/wallpapers/comments= 开头的。
因此我们试着用 =grep= 将符合这个条件的URL过滤出来看看效果怎么样
#+BEGIN_SRC shell :results org
  wget  https://www.reddit.com/r/wallpapers -O - |grep -o -E 'href="([^"#]+)"' |grep -o -E 'https://www.reddit.com/r/wallpapers/comments/[^"]+/'
#+END_SRC

#+RESULTS:
#+BEGIN_SRC org
https://www.reddit.com/r/wallpapers/comments/8efq4z/3d_city_glitch_1920x1080/
https://www.reddit.com/r/wallpapers/comments/8e7k5i/ghost_in_the_shell/
https://www.reddit.com/r/wallpapers/comments/8ebjj0/credit_to_whoever_took_this_picture_i_forget/
https://www.reddit.com/r/wallpapers/comments/8ebyvm/snowy_hills_3840_2160/
https://www.reddit.com/r/wallpapers/comments/8eapkd/beautiful_purple_sunset_1920x180/
https://www.reddit.com/r/wallpapers/comments/8edl5j/vaporwave_hills_3840x2160/
https://www.reddit.com/r/wallpapers/comments/8ebyo5/another_whale_seen_in_the_sky_2880x1800/
https://www.reddit.com/r/wallpapers/comments/8eaglp/tripy_leaf_wallpaper_edited_from_an_unsplash_image/
https://www.reddit.com/r/wallpapers/comments/8e2rq7/rush_downtown_thebadbadben_2732x1536/
https://www.reddit.com/r/wallpapers/comments/8efhr9/all_our_gods_have_abandoned_us_architectsuk/
https://www.reddit.com/r/wallpapers/comments/8e3qbh/remember_this_always_loved_this_wallpaper_from/
https://www.reddit.com/r/wallpapers/comments/8e4ni5/long_past_civlization_4000_2349/
https://www.reddit.com/r/wallpapers/comments/8e6281/bus/
https://www.reddit.com/r/wallpapers/comments/8e2c57/fluid_mechanics_beeple_3840x2160/
https://www.reddit.com/r/wallpapers/comments/8e5j95/tulips_at_5_am_1920x1280/
https://www.reddit.com/r/wallpapers/comments/8e3r13/a_deer_in_the_forest_1920x1080/
https://www.reddit.com/r/wallpapers/comments/8e62jt/froggo/
https://www.reddit.com/r/wallpapers/comments/8e4xv5/abstract_swirls_2560x1600/
https://www.reddit.com/r/wallpapers/comments/8dvuro/samurai_spiral_1536_x_864/
https://www.reddit.com/r/wallpapers/comments/8e1j0g/blossom_wallpaper_shot_by_me/
https://www.reddit.com/r/wallpapers/comments/8dy02y/lagoon_nebula/
https://www.reddit.com/r/wallpapers/comments/8e4t9z/wallpaper_for_multi_screen_setup/
https://www.reddit.com/r/wallpapers/comments/8do356/living_tree_4000_2400/
https://www.reddit.com/r/wallpapers/comments/8dviei/ruined_canvas/
https://www.reddit.com/r/wallpapers/comments/8dvzwe/infinity_gauntlet_3840x2160/
#+END_SRC

过滤结果非常好!


** 随机选择一个链接
要随机选择链接，我们可以使用 =shuf= 命令来打乱链接的顺序，然后选择第一个链接作为我们要访问的链接就行了
#+BEGIN_SRC shell :results org
  wget  https://www.reddit.com/r/wallpapers -O - |grep -o -E 'href="([^"#]+)"' |grep -o -E 'https://www.reddit.com/r/wallpapers/comments/[^"]+/' |shuf |head -1
#+END_SRC

#+RESULTS:
#+BEGIN_SRC org
https://www.reddit.com/r/wallpapers/comments/8dy02y/lagoon_nebula/
#+END_SRC

** 找出帖子链接中图片的URL
按照之前的方法，我们来看看帖子链接中都有哪些链接。不过由于我们只需要图片，因此可以加个限制只显示包含 =.jpg=, =.jpeg=, 或者 =.png= 的URL.
#+BEGIN_SRC shell :results org
  url=$(wget  https://www.reddit.com/r/wallpapers -O - |grep -o -E 'href="([^"#]+)"' |grep -o -E 'https://www.reddit.com/r/wallpapers/comments/[^"]+/' |shuf |head -1)
  wget ${url} -O - |grep -o -E 'href="([^"#]+)"' |grep -E "\.jpg|\.jpeg|\.png"
#+END_SRC

#+RESULTS:
#+BEGIN_SRC org
href="https://www.redditstatic.com/desktop2x/img/favicon/apple-icon-57x57.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/apple-icon-60x60.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/apple-icon-72x72.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/apple-icon-76x76.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/apple-icon-114x114.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/apple-icon-120x120.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/apple-icon-144x144.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/apple-icon-152x152.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/apple-icon-180x180.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/android-icon-192x192.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/favicon-32x32.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/favicon-96x96.png"
href="https://www.redditstatic.com/desktop2x/img/favicon/favicon-16x16.png"
href="https://i.redditmedia.com/Ii0AWUY-N8ibB4bNA0g20PPlNcSc8-nC3kQBlXiT3UA.jpg?s=fb92a5cd0a6d82cb423f87bd3f876b27"
href="https://resi.ze-robot.com/dl/3d/3d-city-glitch-1920×1080.jpg"
href="https://resi.ze-robot.com/dl/3d/3d-city-glitch-1600×900.jpg"
href="https://resi.ze-robot.com/dl/3d/3d-city-glitch-1366×768.jpg"
href="https://resi.ze-robot.com/dl/3d/3d-city-glitch-1280×720.jpg"
href="https://resi.ze-robot.com/dl/3d/3d-city-glitch-1280×800.jpg"
href="https://resi.ze-robot.com/dl/3d/3d-city-glitch-1024×768.jpg"
href="https://resi.ze-robot.com/dl/3d/3d-city-glitch-1280×1024.jpg"
href="https://resi.ze-robot.com/dl/3d/3d-city-glitch-768×1024.jpg"
href="https://i.redd.it/yt2lweavmqt01.jpg"
#+END_SRC

其中 =redditstatic= 中的图片是reddit本身的那些图片，而 =resi.ze=robot.com= 中的图片是提供下载的不同尺寸的地址，我们过滤掉这两个地址
#+BEGIN_SRC shell :results org
  url=$(wget  https://www.reddit.com/r/wallpapers -O - |grep -o -E 'href="([^"#]+)"' |grep -o -E 'https://www.reddit.com/r/wallpapers/comments/[^"]+/' |shuf |head -1)
  wget ${url} -O - |grep -o -E 'href="([^"#]+)"' |grep -E "\.jpg|\.jpeg|\.png" |grep -v -E "www.redditstatic.com|resi.ze-robot.com"
#+END_SRC

#+RESULTS:
#+BEGIN_SRC org
href="https://i.imgur.com/0eSNAHv.jpg"
href="https://i.imgur.com/0eSNAHv.jpg"
href="https://i.imgur.com/0eSNAHv.jpg"
href="https://i.imgur.com/nFZpEAo.png"
href="https://i.imgur.com/0eSNAHv.jpg"
#+END_SRC

还可能剩下多张图片，我们再用 =shuf= 来随机选择其中一张
#+BEGIN_SRC shell :results org
  url=$(wget  https://www.reddit.com/r/wallpapers -O - |grep -o -E 'href="([^"#]+)"' |grep -o -E 'https://www.reddit.com/r/wallpapers/comments/[^"]+/' |shuf |head -1)
  wget ${url} -O - |grep -o -E 'href="([^"#]+)"' |grep -E "\.jpg|\.jpeg|\.png" |grep -v -E "www.redditstatic.com|resi.ze-robot.com" |shuf |head -1
#+END_SRC

#+RESULTS:
#+BEGIN_SRC org
href="https://i.imgur.com/u7Wm6aB.jpg"
#+END_SRC

我们把URL从 =href= 中抽取出来
#+BEGIN_SRC shell :results org
  url=$(wget  https://www.reddit.com/r/wallpapers -O - |grep -o -E 'href="([^"#]+)"' |grep -o -E 'https://www.reddit.com/r/wallpapers/comments/[^"]+/' |shuf |head -1)
  wget ${url} -O - |grep -o -E 'href="([^"#]+)"' |grep -E "\.jpg|\.jpeg|\.png" |grep -v -E "www.redditstatic.com|resi.ze-robot.com" |shuf |head -1 |grep -o -E 'http[^"]+'
#+END_SRC

#+RESULTS:
#+BEGIN_SRC org
https://i.redd.it/iihqrt3zmft01.png
#+END_SRC

** 下载并设置壁纸
我们使用wget来下载壁纸，并通过feh来设置壁纸。

不过有一点需要注意的是，我们上一步中假设壁纸是以 =.jpg=, =.jpeg=, 或者 =.png= 结尾的。
那如果壁纸不是以这三个后缀结尾怎么办？一个简单的办法就是重新再随机选择一次。

#+BEGIN_SRC shell :results org :tangle "~/bin/reddit_wallpaper.sh"
  #!/bin/bash

  function get_image_url()
  {
      url=$(wget  https://www.reddit.com/r/wallpapers -O - |grep -o -E 'href="([^"#]+)"' |grep -o -E 'https://www.reddit.com/r/wallpapers/comments/[^"]+/' |shuf |head -1)
      wget ${url} -O - |grep -o -E 'href="([^"#]+)"' |grep -E "\.jpg|\.jpeg|\.png" |grep -v -E "www.redditstatic.com|resi.ze-robot.com" |shuf |head -1 |grep -o -E 'http[^"]+'
  }

  image_url=$(get_image_url)

  while [[ -z "${image_url}" ]];do
      image_url=$(get_image_url)
  done

  wget ${image_url} -O - |feh --bg-scale -
#+END_SRC
